<!doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<title>Doknosis</title>

	<link href='http://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>
	<link rel='stylesheet' href='/static/css/layout.css'>

	<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
	<script type='text/javascript'>
		function add_finding() {
			var name = $( '#finding_name' ).val();
			var weight = $( '#weight' ).val();

			console.log( name );
			console.log( weight );
			$.post( '/admin/add/{{explanation.mongo_id}}/finding', {'name': name, 'weight': weight}, function(data) {
				$( '#findings' ).append( '<tr><td>' + name + '</td><td>' + weight + '</td>' +
							'<td><button class=\'btn danger\' onclick=\'delete_finding(this, "' +
							name + '");\'>Delete</button></td></tr>' );
				$( '#finding_name' ).val( '' );
				$( '#finding_name' ).focus();
			}, 'JSON' );
		}

		function save() {
			$.get( '/admin/save/explanation/{{explanation.mongo_id}}', { 'name': $( '#explanation' ).val() }, { 'type_identifier': $( '#type_identifier' ).val() }, function( data ) {
				alert( 'Successfully saved!' );
			} );
		}

		function delete_finding( ele, fid ) {
			$.post( '/admin/delete/{{explanation.mongo_id}}/finding/' + encodeURIComponent( fid ), null, function(data) {
				$( ele.parentNode.parentNode ).fadeOut( 'fast', function() {
					$( this ).remove();
				});
			});
		}

		$( function() {
			$( "#finding_name" ).autocomplete({
				source: '/api/finding/autocomplete'
			});
	 	});
	 </script>
</head>

<body>
	<div class="container" style='background-color:#FFF;'>
		<div style='padding: 16px 16px 0 16px;'>
			<div style='margin-bottom:16px;'>
				<a class="brand" href="/admin">Back to Explanatory Variable list/search</a>
			</div>
			<div class='row'>
				<div class='span=8'>
					<input type='text' class='span7' id='explanation' value='{{explanation.name}}' style='font-size:18px;padding:8px;'>
				</div>
				<div>
				  <label>Explanatory Variable Type</label>
				  <select id="type_identifier" class="drop_down">
				    <option value="Diseases">Diseases</option>
				    <option value="Drugs">Drugs</option>
				  </select>
				</div>
				<div class='span4' style='text-align:right;'>
					<button class='btn btn-primary' onclick='save();'>Save Changes</button>
					<a class='btn btn-danger' href='/admin/delete/explanation/{{explanation.mongo_id}}'>
						Delete Explanatory Variable
					</a>
				</div>
			</div>
		</div>
		<div class="row">
			<div class='span12' id='random'>
				<div style='padding:16px;'>
					<h3>Findings for <span style='color:#1691d8;'>{{explanation.name}}</span></h3>
				</div>
				<div style='padding: 0 16px;'>
					<table id='findings' class='table table-striped table-condensed'>
						<tr><td>
							<input type='text' id='finding_name' placeholder='finding name'>
						</td><td>
							<select id='weight'>
								<option value='1.0'>a ( 1.0 )</option>
								<option value='0.75'>c ( 0.75 )</option>
								<option value='0.5'>p ( 0.5 )</option>
								<option value='0.25'>i ( 0.25 )</option>
								<option value='0.1'>r ( 0.1 )</option>
								<option value='0'>n ( 0.0 )</option>
								<option value='0.95'>d ( 0.95 )</option>
								<option value='0.65'>e ( 0.65 )</option>
								<option value='0.5'>f ( 0.5 )</option>
								<option value='0.25'>g ( 0.25 )</option>
								<option value='0.1'>h ( 0.1 )</option>
							</select>
						</td><td>
							<button class='btn small' onclick='add_finding();'>Add Finding</button>
						</td></tr>
						{% for finding in findings %}
						<tr>
							<td>{{finding.name}}</td>
							<td>{{finding.weight}}</td>
							<td><button class='btn btn-danger' onclick='delete_finding(this, "{{finding.name}}");'>Delete</button></td>
						</tr>
						{% endfor %}
					</table>
				</div>
			</div>
			<div class='span12' id='edit'>
			</div>
		</div>
	</div>
</body>
</html>
