// Generated by CoffeeScript 1.3.3
var clear_all, get_diagnosis, toggle_loading;

toggle_loading = function() {
  $('#loading-indicator').toggle();
  return this;
};

clear_all = function() {
  window.symptoms = [];
  $('.rm').fadeOut('fast', function() {
    $(this.parentNode).remove();
    return this;
  });
  if ($('#symptoms-list > .help-text').length === 0) {
    $('#symptoms-list').append('<div class=\'help-text\'>No Symptoms Entered</div>');
  }
  $('#results').hide();
  return this;
};

get_diagnosis = function() {
  var params;
  if (window.symptoms.length === 0) {
    alert('Please enter some symptoms first!');
    return;
  }
  $('#results').hide();
  $('#results-list').html('');
  toggle_loading();
  if ($('#banner-bar').data('at_top') !== true) {
    $('#banner-bar').data('at_top', true).animate({
      top: '0%',
      marginTop: '+=109'
    }, 500, null);
  }
  params = {
    findings: window.symptoms.join(','),
    num_solutions: $('#num_solutions').val(),
    num_combinations: $('#num_combinations').val(),
    algorithm: $('#algorithm').val()
  };
  $.getJSON('/diagnosis_result', params, function(data) {
    var i, results_table, _i, _ref;
    if (data.success === !true) {
      return;
    }
    $('#query-time').html("DB QUERY TIME: " + data.query_time);
    $('<div/>').addClass('diagnosis').html("<strong>Most Likely:</strong> " + data.greedy).appendTo('#results-list');
    results_table = $('<table/>').addClass('results-table').addClass('table').addClass('table-striped').append('<tr><th>Name</th><th>Score</th></tr>');
    for (i = _i = 0, _ref = data.other.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      $('<tr/>').append("<td> " + data.other[i][0] + " </td>").append("<td> " + data.other[i][1] + " </td>").appendTo(results_table);
    }
    toggle_loading();
    results_table.appendTo('#results-list');
    return $('#results').fadeIn();
  });
  return this;
};

$(function() {
  window.symptoms = [];
  $(document).on('click', '.rm', function() {
    var i, id, _i, _ref;
    id = $(this).data('sid');
    for (i = _i = 0, _ref = window.symptoms.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      if (window.symptoms[i] === id) {
        window.symptoms.splice(i, 1);
      }
    }
    return $(this.parentNode).fadeOut('fast', function() {
      $(this).remove();
      if ($('#symptoms-list > .label').length === 0) {
        return $('#symptoms-list').append('<div class=\'help-text\'>No Symptoms Entered</div>');
      }
    });
  });
  $("#symptoms").autocomplete({
    source: '/api/finding/autocomplete',
    select: function(event, ui) {
      var text;
      text = ui.item.label;
      ui.item.value = '';
      $('#symptoms-list > .help-text').remove();
      $('#symptoms-list').append('<span class="label"><span>' + text + '</span><span data-sid="' + ui.item.id + '" class="rm">x</span></span>');
      return window.symptoms.push(ui.item.id);
    }
  });
  return this;
});
